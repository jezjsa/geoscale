# View Content & Action Icons Feature

## Date: November 20, 2025

## Overview

Added a complete content viewing system with:
1. **View Content Page** - Full page to preview generated content
2. **Action Icons** - View and Regenerate icons always visible in combinations table
3. **WordPress Slug Generation** - Automatic slug creation in WordPress format

## Feature 1: View Content Page

### Route
`/projects/:projectId/content/:locationKeywordId`

### Purpose
Allows users to preview and review generated content before pushing to WordPress.

### Displays

#### 1. Page Title
- Full page title as generated by AI
- Shows the combination phrase as a badge

#### 2. URL Slug
- WordPress-formatted permalink
- Example: "Doncaster Web Design" â†’ `/doncaster-web-design`
- Automatically generated from title
- Follows WordPress standards:
  - Lowercase
  - Spaces â†’ hyphens
  - Special characters removed
  - No leading/trailing hyphens

#### 3. SEO Meta Data

**Meta Title:**
- SEO-optimized title (60 characters max)
- Character count displayed
- Shows in search results

**Meta Description:**
- SEO-optimized description (155 characters max)
- Character count displayed
- Shows in search results

#### 4. Page Content

**Preview Section:**
- Rendered HTML preview
- Styled with prose classes for readability
- Shows how it will look on website

**HTML Source:**
- Expandable details section
- Raw HTML code
- Copy-friendly format
- Useful for debugging or manual edits

#### 5. Metadata
- Created timestamp
- Last updated timestamp
- Shows generation history

### Navigation

**Back Button:**
- Returns to project combinations tab
- Preserves project context
- Breadcrumb shows: Back / Project Name

**Edit Button:**
- Currently disabled (placeholder)
- Will implement TinyMCE editor later
- Shows "Coming Soon" tooltip

### Future: TinyMCE Integration

**Planned Features:**
- Inline content editing
- WYSIWYG editor for HTML
- Edit title, meta title, meta description
- Save changes back to database
- Preview changes before saving
- Revision history

## Feature 2: Action Icons (Always Visible)

### Design Philosophy
Show all action icons by default but greyed out, becoming active based on status. This provides:
- **Consistency** - Same layout across all rows
- **Discoverability** - Users know what actions are available
- **Clarity** - Visual feedback on why actions are disabled

### Icons in Actions Column

#### 1. View Icon (ğŸ‘ï¸ Eye)

**Lucide Icon:** `Eye`

**Active when:**
- Status: `generated`
- Status: `pushed`

**Greyed out when:**
- Status: `pending` (not yet generated)
- Status: `generating` (in progress)
- Status: `error` (no content to view)

**Tooltip:**
- Active: "View content"
- Disabled: "Content not generated yet"

**On Click:**
- Navigates to View Content page
- Shows full content preview

**Visual States:**
```
Active:   Eye icon (normal gray) â†’ hover (green #006239)
Disabled: Eye icon (light gray 30% opacity) â†’ no hover
```

#### 2. Regenerate Icon (ğŸ”„ RefreshCw)

**Lucide Icon:** `RefreshCw`

**Active when:**
- Status: `generated` (regenerate to improve)
- Status: `error` (retry generation)

**Greyed out when:**
- Status: `pending` (nothing to regenerate)
- Status: `generating` (already in progress)
- Status: `pushed` (would need to be unpushed first)

**Tooltip:**
- Active: "Regenerate content"
- Disabled: "Cannot regenerate"

**On Click:**
- Deletes old content
- Resets to pending
- Triggers new generation
- Shows progress indicator

**Visual States:**
```
Active:   RefreshCw icon (normal gray) â†’ hover (green #006239)
Disabled: RefreshCw icon (light gray 30% opacity) â†’ no hover
```

## Feature 3: WordPress Slug Generation

### Algorithm

**Function:** `generateSlug(title: string)`

**Process:**
```typescript
1. Convert to lowercase
2. Trim whitespace
3. Remove special characters (keep letters, numbers, spaces, hyphens)
4. Replace spaces with hyphens
5. Replace multiple hyphens with single hyphen
6. Remove leading/trailing hyphens
```

**Examples:**
```
"Doncaster Web Design"           â†’ "doncaster-web-design"
"Web Design in Rotherham"        â†’ "web-design-in-rotherham"
"Best Web Design - Barnsley"     â†’ "best-web-design-barnsley"
"Web Design & Development"       â†’ "web-design-development"
"  Web Design  "                 â†’ "web-design"
"Web---Design"                   â†’ "web-design"
```

### Storage
- Generated automatically by Edge Function
- Stored in `generated_pages.slug` column
- Created during content generation
- Unique per page

### Database Schema Update

**Migration:** `add_slug_to_generated_pages`

```sql
ALTER TABLE generated_pages 
ADD COLUMN IF NOT EXISTS slug TEXT;
```

**Column Details:**
- Type: TEXT
- Nullable: Yes (for backwards compatibility)
- Indexed: Not required (not used for queries)
- Used for: WordPress permalink when pushing

## User Experience Flow

### View Generated Content

```
1. User sees combinations table
2. Content has status "generated"
3. Eye icon ğŸ‘ï¸ is active (normal color)
4. User hovers â†’ icon turns green
5. User clicks Eye icon
6. Navigates to View Content page
7. Reviews title, content, meta data, slug
8. Uses Back button to return
```

### Regenerate Content

```
1. User reviews content (not satisfied)
2. Returns to combinations table
3. RefreshCw icon ğŸ”„ is active
4. User hovers â†’ icon turns green
5. User clicks RefreshCw icon
6. Old content deleted
7. New generation starts
8. Progress bar appears
9. Status updates in real-time
10. New content ready to view
```

### Icons Always Visible

```
Combinations Table:

Phrase                      Location   Status      Actions
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
web design in doncaster     Doncaster  pending     ğŸ‘ï¸ğŸ”„  (both greyed)
web design in rotherham     Rotherham  generating  ğŸ‘ï¸ğŸ”„  (both greyed)
web design in barnsley      Barnsley   generated   ğŸ‘ï¸ğŸ”„  (both active)
web design in wakefield     Wakefield  error       ğŸ‘ï¸ğŸ”„  (regen active)
web design in sheffield     Sheffield  pushed      ğŸ‘ï¸ğŸ”„  (view active)
```

## Current AI Generation Output

The OpenAI o1 model currently generates ALL required fields:

### Generated Fields
1. âœ… **Title** - Page title
2. âœ… **Slug** - WordPress permalink (auto-generated from title)
3. âœ… **Meta Title** - SEO title (60 chars)
4. âœ… **Meta Description** - SEO description (155 chars)
5. âœ… **Content** - Full HTML content

### JSON Response Format
```json
{
  "title": "Web Design in Doncaster - 55 Digital",
  "meta_title": "Web Design Doncaster | Professional Web Design Services",
  "meta_description": "Expert web design services in Doncaster. Modern, responsive websites that drive results. Call today for a free consultation.",
  "content": "<h1>Web Design in Doncaster</h1><section>...</section>"
}
```

### Future: Separate Meta Description Prompt

**User Request:** May want different prompt for meta description

**Current:** Single prompt generates everything
**Future:** Could split into two API calls:
1. Main content generation
2. Separate meta description generation with specific flow

**Benefits of Separate Prompt:**
- More control over meta description format
- Different tone/style for search results
- A/B test meta descriptions
- Optimize for CTR separately

**Implementation (when needed):**
- Create new Edge Function: `generate-meta-description`
- Custom prompt template: `/meta_description_prompt.md`
- Call after main content generation
- Update existing meta descriptions in bulk

## Technical Implementation

### New Files Created

1. **ViewContentPage.tsx**
   - Full content preview page
   - React component with React Router
   - Uses Supabase queries
   - Styled with ShadCN components

2. **Router Update**
   - Added `/projects/:projectId/content/:locationKeywordId` route
   - Protected route (requires authentication)
   - Integrated with TanStack Router

3. **Edge Function Update**
   - Added `generateSlug()` function
   - Generates slug from title
   - Stores in `generated_pages.slug`

### Database Changes

**Migration:** `add_slug_to_generated_pages`
- Added `slug` column to `generated_pages` table
- Type: TEXT
- Nullable (backwards compatible)

### Component Updates

**CombinationsTable.tsx:**
- Added `Eye` icon import
- Added `useNavigate` hook
- Added `handleViewContent` function
- Updated Actions column to show both icons
- Icons always visible with conditional styling
- Tooltips explain disabled state

## UI/UX Improvements

### Visual Consistency
- All rows show same action icons
- No layout shift between states
- Clear visual feedback on hover
- Consistent spacing and alignment

### User Feedback
- Tooltips explain why icons are disabled
- Hover states show interactivity
- Color coding: gray â†’ green on hover
- Cursor changes: pointer vs not-allowed

### Accessibility
- Icons have descriptive tooltips
- Buttons are keyboard navigable
- Clear disabled states
- ARIA labels (implicit via title attribute)

## Files Modified/Created

### Created:
- `/src/pages/ViewContentPage.tsx` - Content preview page
- `/VIEW_CONTENT_FEATURE.md` - This documentation

### Modified:
- `/supabase/functions/generate-content/index.ts` - Added slug generation
- `/src/components/projects/CombinationsTable.tsx` - Added view icon, updated actions
- `/src/router.tsx` - Added view content route
- Database: Added `slug` column via migration

## Testing Checklist

### View Content Page
- [ ] Navigate from combinations table
- [ ] View icon appears on generated items
- [ ] Click view icon opens content page
- [ ] Page shows title correctly
- [ ] Slug displays in correct format
- [ ] Meta title shows with character count
- [ ] Meta description shows with character count
- [ ] Content preview renders HTML
- [ ] HTML source is expandable
- [ ] Timestamps display correctly
- [ ] Back button returns to project

### Action Icons
- [ ] Both icons visible on all rows
- [ ] View icon active for "generated"
- [ ] View icon active for "pushed"
- [ ] View icon greyed for "pending"
- [ ] View icon greyed for "generating"
- [ ] View icon greyed for "error"
- [ ] Regenerate icon active for "generated"
- [ ] Regenerate icon active for "error"
- [ ] Regenerate icon greyed for "pending"
- [ ] Regenerate icon greyed for "generating"
- [ ] Regenerate icon greyed for "pushed"
- [ ] Tooltips show correct messages
- [ ] Hover states work correctly
- [ ] Icons turn green on hover when active
- [ ] Cursor changes appropriately

### Slug Generation
- [ ] Slug created automatically
- [ ] Slug in lowercase
- [ ] Spaces converted to hyphens
- [ ] Special characters removed
- [ ] Multiple hyphens become single
- [ ] No leading/trailing hyphens
- [ ] Works with various title formats
- [ ] Slug stored in database

## Known Limitations

### View Content Page
1. **No editing yet** - TinyMCE integration pending
2. **No version history** - Shows current version only
3. **No comparison** - Can't compare with previous version
4. **No preview modes** - Desktop/mobile/tablet views

### Action Icons
1. **No bulk actions** - Icons work one at a time
2. **No undo** - Regenerate deletes old content permanently
3. **No preview before regenerate** - Would need confirmation dialog

### Slug Generation
1. **No custom slugs** - Generated automatically only
2. **No duplicate check** - Doesn't check WordPress for conflicts
3. **No slug history** - If title changes, slug regenerates

## Future Enhancements

### Short Term
- [ ] TinyMCE editor integration
- [ ] Edit title, meta fields inline
- [ ] Save edited content
- [ ] Preview desktop/mobile views

### Medium Term
- [ ] Custom slug editor
- [ ] Slug availability checker (WordPress API)
- [ ] Content version history
- [ ] Compare old vs new versions
- [ ] Confirmation before regenerate

### Long Term
- [ ] A/B test different versions
- [ ] Content templates library
- [ ] AI suggestions for improvements
- [ ] SEO score for meta data
- [ ] Readability analysis
- [ ] Plagiarism checker

## WordPress Integration (Next Step)

The slug will be used when pushing to WordPress:

```
POST /wp-json/geoscale/v1/create-page

{
  "title": "Web Design in Doncaster",
  "slug": "doncaster-web-design",  â† Generated slug
  "content": "<h1>...</h1>",
  "meta_title": "...",
  "meta_description": "..."
}
```

---

**Implementation completed:** November 20, 2025  
**Status:** âœ… Complete and ready for testing  
**Next Step:** Test content generation â†’ view â†’ regenerate workflow

